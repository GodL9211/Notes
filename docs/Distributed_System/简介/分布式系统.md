# 分布式系统

：将一个软件系统的各个组件分别部署在多台计算机上。
- 小型的软件系统通常只部署在一台计算机上，属于集中式系统。而大型的软件系统通常部署成分布式系统，从而扩展出更多性能。
- 优点：
  - 便于横向扩展系统节点，提高系统容量、性能，比如处理高并发流量。
  - 可以为一个软件应用运行多个实例，提高服务可用性。
  - 可以为一个数据存储多个副本，提高数据安全性。
- 缺点：
  - 各个节点之间需要保证一致性。
  - 系统规模变大、结构变复杂，维护麻烦。
  - 比集中式系统多用了一些技术和组件，比如负载均衡、消息队列、分布式锁、分布式数据库、分布式文件系统。

## 一致性算法

分布式系统中常见的一致性算法：
- Paxos
- Zab（Zookeeper Atomic Broadcast）
- Raft

## ZooKeeper

：一个维护分布式系统的一致性的软件。
- 原本是 Hadoop 的子项目，现在已成为一个独立的顶级项目。
  - 取名为 ZooKeeper 是因为 Yahoo 公司的 Pig 等项目都是以动物命名，ZooKeeper 可以协调它们。
- ZooKeeper 常用作生产者和消费者的注册中心。
  - 生产者将自己提供的服务在 ZooKeeper 上注册，消费者要调用服务时就去 ZooKeeper 查找该服务。
- ZooKeeper 集群中的各个 server 并不采用主备模式（master/slave），而是分为 leader、follower、observer 三种角色（借鉴 Paxos 算法的思想）。
  - leader ：负责处理 client 的读请求和写请求，更新系统的状态并推送给 follower、observer 。
leader 由 follower 选举产生。
  - follower ：负责处理 client 的读请求，参与 leader 选举。
  - observer ：负责处理 client 的读请求，扩展系统的读取速度。
- ZooKeeper 集群采用 Zab 算法实现一致性，其原则是：如果多数 server 写入数据成功，则数据为真。
  - 使用 3 个 server 就可以组成一个 ZooKeeper 集群。
  - server 数为 3 时，最多允许 1 个 server 挂掉；server 数为 4 时，也是最多允许 1 个 server 挂掉。因此 server 数最好为奇数，为偶数时可靠性并不会提升。

## Etcd

：一个分布式的键值对数据库。
- 由 CoreOS 团队于 2013 年开源，基于 Golang 开发。
- 采用 Raft 算法实现分布式系统的一致性。
