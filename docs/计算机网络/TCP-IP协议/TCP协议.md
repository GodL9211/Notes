# TCP/IP协议

TCP/IP协议簇包含多种协议，是因特网的核心通信协议。

## IP协议

：因特网协议（Internet Protocol）
- 规定了网络上的主机用IP地址确定自己的身份，属于网络层协议。
- 面向无连接，只提供尽力而为的数据传输服务：只管把数据发送出去，不进行差错控制。
  - 是不可靠的通信协议。

## TCP协议

：传输控制协议（Transmission Control Protocol）
- 规定了网络上的主机之间如何传输数据，属于传输层协议。
- 面向连接：通信双方在通信之前要先建立信道。
  - 是可靠的通信协议，可保证消息顺序，可进行差错控制、流量控制。
- 采用C/S架构，通信双方分别称为server、client。
- 可进行全双工通信。

### 数据包结构

TCP数据包包含以下信息：
- 源端口 ：16 bit
- 目标端口 ：16 bit
- seq ：序列号，32 bit，用于保证消息顺序。
- ack ：确认号，32 bit，表示期望收到的下一个序列号。
- ...
- flag ：标志符，9 bit，每个bit对应一个标志位，默认为0。
  - ACK=1 ：表示确认号有效。
  - RST=1 ：要求重新建立TCP连接，也可用于拒绝连接。
  - SYN=1 ：用于同步。
  - FIN=1 ：表示结束连接。
- checksum ：校验和，16 bit
- ...
- 数据

### 建立连接

建立TCP连接时需要经过三个步骤，称为“三次握手”：
1. client发送一个SYN=1的TCP包，表示请求连接。
2. server收到后，回复一个ACK=1、SYN=1的TCP包，表示允许连接。
3. client收到后，发送一个ACK=1的TCP包，表示正式建立连接。

- 总之，通信双方都要发送一个SYN、一个ACK。
- 主动建立TCP连接的一方是client。

### 断开连接

断开TCP连接时需要经过四个步骤，称为“四次分手”：
1. 主机A发送FIN，表示请求断开连接。
2. 主机B收到后，先回复ACK，表示同意断开连接。
   <br>准备好了之后再发送FIN，也请求断开连接。
3. 主机A收到后，发送一个ACK，表示自己已经断开连接。
4. 主机B收到后，正式断开连接。

- 总之，通信双方都要发送一个FIN、一个ACK。
- client、server都可以主动断开连接，因此这里用主机A、主机B代称。

## UDP协议

：用户数据报协议（User Datagram Protocol）
- 与TCP协议类似，只是面向无连接。
- 通信双方分别称为sender、receiver。
