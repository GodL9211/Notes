# 访问权限

## 管理用户

```sql
select * from mysql.user\G;                   -- 显示所有用户的信息

create user 'root'@'127.0.0.1';               -- 创建用户 root ，只允许从该 IP 地址登录，且不需要输入密码
create user 'root'@'10.0.%';                  -- 创建用户 root ，允许从该 IP 网段登录，且不需要输入密码
create user 'root'@'%' identified by 'aaa';   -- 创建用户，允许从任何 IP 地址登录，密码是 aaa

set password for 'root'@'localhost' = password('******');   -- 给用户设置密码，密码值通过 password() 函数加密输入
update mysql.user set password=password('******') where user='root' and host='localhost';  -- 修改用户的密码（如果该名字的用户只有一个，可以不指定 and host=...

drop user 'root'@'localhost';                 -- 删除用户
```
- 用户的账号信息存储在 mysql.user 表 中。
- 从 MySQL 5.7 开始，mysql.user 表的 password 字段改名为 authentication_string 字段，因此要使用以下语句修改密码：
  ```sql
  update mysql.user set authentication_string=password('******') where user='root';
  ```

## 管理用户的权限

```sql
show grants;                                -- 查看当前用户的权限
show grants for 'root'@'localhost';         -- 查看指定用户的权限

grant select,insert,update,delete on db1.* to 'root'@'localhost'; -- 授予用户对于数据库 db1 中所有数据表的查询、修改、插入、删除权限
grant all on *.* to 'root'@'localhost';                           -- 授予用户对于所有数据库的全部权限

FLUSH PRIVILEGES;                           -- 刷新权限表（否则要等到 MySQL 服务器重启时才会生效）

revoke all on *.* from 'root'@'localhost';  -- 将 grant...to 改为 revoke...from ，就是撤销权限
```

## 免密模式

如果忘记了密码，可以按以下步骤找回：
1. 在 mysqld 的配置文件中加入以下参数，然后重启 mysqld ：
    ```ini
    [mysqld]
    skip-grant-tables     # 跳过权限验证，此时不需要密码就能访问所有数据库
    skip-networking       # 禁止本机以外的客户端进行 TCP 连接
    ```
    或者通过命令行选项开启免密模式：
    ```sh
    mysqld --skip-grant-tables --skip-networking
    ```

2. 用客户端登录 MySQL ，在免密模式下修改密码。

3. 重新按正常的方式启动 mysqld 。

