# 函数

- 关于字符串的函数：
  ```sql
  SELECT ASCII('hello');    -- 返回第一个字符的 ASCII 码
  -> 104

  SELECT RTRIM(' hello ');  -- 去除字符串右侧的空字符
  SELECT LTRIM(' hello ');  -- 去除字符串左侧的空字符
  SELECT TRIM(' hello ');   -- 去除字符串两侧的空字符

  SELECT UPPER('Hello');    -- 将每个字符转换为大写
  -> HELLO
  SELECT LOWER('Hello');    -- 将每个字符转换为小写
  -> hello

  SELECT LENGTH('hello');           -- 返回字符串的长度
  -> 5
  SELECT SUBSTRING('hello', 1);     -- 返回字符串的子串，从第 1 个字符开始的所有字符
  -> hello
  SELECT SUBSTRING('hello', 1, 2);  -- 返回字符串的子串，从第 1 个字符开始的最多 2 个字符
  -> he

  SELECT CONCAT('a', 'b', 'c');         -- 将多个字符串拼接为一个字符串
  -> a,b,c
  SELECT CONCAT_WS(',', 'a', 'b', 'c'); -- 用分隔符拼接字符串
  -> abc
  ```

- 关于数学运算的函数：
  ```sql
  SELECT RAND();              -- 返回一个随机数，取值范围为 0~1
  -> 0.5708063892748266

  SELECT ABS(-3.14);          -- 计算绝对值
  -> 3.14
  SELECT ABS('-3.14');        -- MySQL 支持将字符串自动转换成数值
  -> 3.14
  SELECT ABS('hello');        -- 如果字符串不能转换成数值，则当作 0 处理
  -> 0

  SELECT ROUND(3.5);          -- 取整，默认保留 0 位小数，多余的小数位会四舍五入
  -> 4
  SELECT ROUND(3.146, 1);     -- 保留 n 位小数时，只会对第 n+1 位进行四舍五入，不会考虑全部小数位
  -> 3.1
  SELECT FORMAT(3.15, 1);     -- 格式化数值，保留 1 位小数，多余的小数位会四舍五入
  -> 3.12
  SELECT FORMAT(3.15, 3);     -- 保留 3 位小数，不足的小数位会用 0 填充
  -> 3.150
  SELECT TRUNCATE(3.15, 1);   -- 保留 1 位小数，不会四舍五入
  -> 3.1
  SELECT CEIL(3.14);          -- 返回大于等于 3.14 的最小整数
  -> 4
  SELECT FLOOR(3.14);         -- 返回小于等于 3.14 的最小整数
  -> 3

  SELECT POW(9, 0.5);         -- 计算 2 的 0.5 次幂
  -> 3
  SELECT POW(4, -0.5);        -- 幂指数可以是负数、小数
  -> 0.5
  ```

- 关于数学统计的函数：
  ```sql
  SELECT COUNT(*) FROM tb1;             -- 计算数据表中有多少行数据。此时会自动使用聚集索引，或开销更小的二级索引，避免全表扫描
  SELECT COUNT(*) FROM tb1 WHERE name='one';  -- COUNT(*) 加 where 子句时，需要分析查询条件是否使用索引
  SELECT COUNT(id) FROM tb1;            -- 计算 id 字段有多少个取值，不包括取值为 null 的情况
  SELECT COUNT(DISTINCT  id) FROM tb1;  -- 计算 id 字段有多少个不重复的取值，不包括取值为 null 的情况

  SELECT AVG(id) FROM tb1;    -- 计算 id 字段的平均值
  SELECT SUM(id) FROM tb1;    -- 总和
  SELECT MAX(id) FROM tb1;    -- 最大值
  SELECT MIN(id) FROM tb1;    -- 最小值
  SELECT MIN(id) as min_id, MAX(id) as max_id FROM tb1; -- 可同时计算多个统计值
  ```

- 关于时间的函数：
  ```sql
  SELECT NOW();                   -- 返回当前的时间字符串，采用默认格式
  -> 2020-01-01 12:15:05
  SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s');   -- 返回指定格式的时间字符串
  -> 2020-01-01 12:15:05
  SELECT DAY('2020-01-01');       -- 提取时间中的年份，类似的函数有 YEAR()、MONTH()、DAY()、WEEKDAY()、HOUR()、SECOND()
  -> 2020

  SELECT TO_DAYS('2020-01-01');   -- 将指定时间转换成天数，以公元 0 年为起点
  -> 737790
  SELECT UNIX_TIMESTAMP(NOW());   -- 将指定时间转换成 Unix 时间戳，单位为秒
  -> 1577852105
  SELECT ROUND((UNIX_TIMESTAMP('2020-01-01 12:15:05') - UNIX_TIMESTAMP('2020-01-01 11:15:05')) / 60);   -- 计算两个时间相差的秒数
  -> 60
  SELECT TIMESTAMPDIFF(HOUR, '2020-01-01', '2020-01-02');   -- 计算第二个时间减去第一个时间的差值，单位为 HOUR
  -> 24

  SELECT DATE_ADD('2020-01-01', INTERVAL 10 DAY);   -- 在指定时刻的基础上，增减一段时间
  -> 2020-01-11
  SELECT DATE_ADD('2020-01-01', INTERVAL -1 HOUR);
  -> 2019-12-31 23:00:00
  ```

- 其它函数：
  ```sql
  SELECT VERSION();       -- 返回服务器的版本号
  -> 8.0.15-12
  SELECT DATABASE();      -- 返回当前数据库
  -> mysql
  SELECT CURRENT_USER();  -- 返回当前登录的账户名
  -> test@%
  SELECT SESSION_USER();  -- 返回当前会话的客户端地址
  -> test@10.42.1.2

  SELECT IF(1>0, 'true', 'false');    -- 如果表达式为真，则返回第一个字符串，否则返回第二个字符串
  -> true
  ```
