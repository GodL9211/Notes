# 管理单元

ES 的管理单元从上到下依次分为：
- **index**
  - ：索引，相当于 MySQL 的数据库（与MySQL的索引是不同概念）。
  - 一个 ES 服务器中可以存储多个 index 。
  - index 名可以包含小写字母、数字、下划线，但不能包含大写字母。
- **type**
  - ：类型，相当于 MySQL 的数据表。
  - 每个 index 中可以存储多个 type 。
- **document**
  - ：文档，相当于 MySQL 的数据行。
  - 每个 type 中可以存储多个 document。
  - 每个 document 是一段 JSON 格式的字符串，描述了一个对象的信息。

## document

### 增

用 POST 方法可以新增一个 document ，ES会自动创建相应的 index 和 type ，并且为该 document 分配一个随机的、唯一的 id 。如下：
```sh
[root@Centos ~]# curl -X POST 127.0.0.1:9200/school/student?pretty -H 'content-Type:application/json' -d '
> {
>     "name" : "Leo",
>     "age" : 10,
>     "interests": [ "sports", "music" ]
> }'
{
  "_index" : "school",              # index的名字
  "_type" : "student",              # type的名字
  "_id" : "ZhzMiXABzduhqPWX7mUX",   # 随机分配的id
  "_version" : 1,                   # 表示该document是第几次被修改，从1开始递增
  "result" : "created",             # 表示成功创建了该document
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 0,                    # 表示这是对该 type 的第几次写操作（包括POST、PUT、DELETE），从0开始递增
  "_primary_term" : 1               # 表示这是第几次分配的 Primary Shard ，从1开始递增
}
```
- 请求的目标URL `/school/student` 中， school 表示 index 的名字，student 表示 type 的名字。

### 改

用 PUT 方法可以创建或修改指定 id 的 document 。如下：
```
PUT /school/student/1
{
    "name" : "Leo",
    "age" : 10,
    "interests": [ "sports", "music" ]
}
```

### 查

用 HEAD 方法可以查询指定 id 的 document 是否存在。

用 GET 方法可以查询指定 id 的 document 的内容：
```sh
[root@Centos ~]# curl -X GET 127.0.0.1:9200/school/student/1?pretty
{
  "_index" : "school",
  "_type" : "student",
  "_id" : "1",
  "_version" : 9,
  "_seq_no" : 17,
  "_primary_term" : 1,
  "found" : true,
  "_source" : {         # _source 字段的值就是该 document 的内容
    "name" : "Leo",
    "age" : 10,
    "interests" : [
      "sports",
      "music"
    ]
  }
}
```

将 GET 请求的目标URL的最后一段填入 _search ，则可进行高级搜索。
- 下例是直接搜索，默认最多返回 10 个document。
    ```
    GET /school/student/_search
    ```
- 下例是在URL的查询字符串中加入 q 字段及查询参数。
    ```
    GET /school/student/_search?q=name:Leo
    ```
- 下例是在请求报文body中加入JSON格式的查询参数，进行DSL查询：
    ```
    GET /school/student/_search
    {
        "query" : {
            "match" : {
                "name" : "Leo"
            }
        }
    }
    ```

### 删

用 DELETE 方法可以删除指定 id 的 document 。如下：

```sh
[root@Centos ~]# curl -X DELETE 127.0.0.1:9200/school/student/8?pretty
{
  "_index" : "school",
  "_type" : "student",
  "_id" : "8",
  "_version" : 2,
  "result" : "deleted",     # 已删除该 document
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 25,
  "_primary_term" : 1
}
```

```sh
[root@Centos ~]# curl -X DELETE 127.0.0.1:9200/school/student/8?pretty
{
  "_index" : "school",
  "_type" : "student",
  "_id" : "8",
  "_version" : 3,
  "result" : "not_found",       # 该 document 不存在
  "_shards" : {
    "total" : 2,
    "successful" : 1,
    "failed" : 0
  },
  "_seq_no" : 26,
  "_primary_term" : 1
}
```
