
# 定时任务

## at

：用于设置一次性的定时任务。
- 定时任务即在某个时刻执行某些命令。
- 当一次性的定时任务被执行或超时之后，就会被从任务表删除。
- 命令：
    ```shell
    $ at
        11:30 2019-08-16 < run.sh  # 将.sh脚本的内容设置成定时任务
        -l                         # 显示所有尚未执行的任务
        -c <任务序号>              # 显示某个任务的内容
        -r <任务序号>              # 删除一个任务
    ```
    - 例：将要执行的命令通过管道符传给at
    ```shell
    echo "systemctl restart docker" | at 23:00
    ```
- at指定的任务时间可以是多种格式：
    ```shell
    at 23:00           # 在今天的指定时刻（如果已超过该时刻，则定位到明天的该时刻）
    at now + 3 minutes # 在3分钟之后
    at now + 3 hours   # 在3小时之后
    at 23:00 + 3 days  # 在3天之后的23:00
    ```

## crontab

：用于设置循环执行的定时任务。
- 命令：
    ```shell
    $ crontab
              -e        # 编辑当前用户的循环定时任务
              -u <user> # 编辑指定用户的任务
              -l        # 显示任务内容
              -r        # 删除任务内容
    ```
- 编辑时会打开任务列表，每行定义一条任务，如下：
    ```shell
    0 0 * * 6,7 /usr/bin/bash /root/run.sh      # 在周六、周日的00:00时刻执行任务
    */1 * * * 1-5 /usr/bin/bash /root/run.sh    # 在周一至周五，每隔1分钟执行一次任务
    ```
    - 前五个参数表示时间：第几分钟、第几小时、第几日、第几月、周几。如果没有值则填 * ；“分钟”必须要填；“日”与“周”不能同时填。
    - 后面的命令要使用绝对路径。

## 开机自动执行的脚本

- /etc/profile ：在每个用户登录系统时自动执行。
  - 主要用于定义PATH等环境变量。
  - 要增加内容时，建议不要修改 /etc/profile ，而是保存为 /etc/profile.d/*.sh ，这些脚本会被 /etc/profile 执行。
- /etc/bashrc ：在每个用户创建shell时自动执行。
  - 主要用于设置一些alias别名。
- ~/.bash_profile ：在当前用户登录系统时自动执行。
- ~/.bashrc ：在当前用户以交互模式创建一个shell时自动执行。
- ~/.bash_logout ：在当前用户登出系统时自动执行。
- 例：
  - 登录系统时，或使用su -切换用户时，会依次执行 /etc/profile、/etc/bashrc、~/.bashrc、~/.bash_profile 。
  - 执行bash打开一个新shell时，或使用su切换用户时，会依次执行 /etc/bashrc、~/.bashrc 。
  - 退出一个shell时没有脚本会被执行。
  - 登出系统时会执行~/.bash_logout。
