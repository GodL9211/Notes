# 简介

## 系统架构

Linux 系统架构从上到下分为三层：
- User Space ：运行用户态进程。
  - 用户启动的进程一般运行在用户态，只使用虚拟内存空间中的用户内存空间。
  - 当用户态进程调用内核 API、遇到中断或异常时，就会下沉到内核态，有权限执行内核内存空间中的代码、访问底层硬件。
- Kernel Space ：运行内核态进程。
  - System Call Interface（SCI）：向上对用户空间提供内核接口。
  - Virtual File System（VFS）：一个抽象的文件系统层，向下管理不同类型的文件系统，向上提供统一的文件系统接口。
  - File System ：实际的文件系统层，包括多种文件系统。
  - General Block Device Layer ：一个抽象的块设备层，向下管理不同类型的硬件设备，向上提供统一的 IO 接口。
  - Device Driver ：有很多种，分别管理不同设备。
- Hardware Layer ：计算机底层的硬件层。

## 中断

Linux 系统处理中断的过程通常分为两步：
1. 处理硬件中断请求，立即处理其中不能延误的任务。
2. 以软件中断的形式执行剩下的任务，比如创建成内核线程。
  - 这样既可以及时执行中断中重要的任务，又可以延迟执行耗时久的任务。
  - 例如，当网卡收到数据帧时，会发出一个硬中断，让网卡驱动程序把数据帧放到内存中。然后网卡驱动程序会发出一个软中断，调用某个内核进程来解析数据帧，转换成 IP 数据包，最后发送给应用层的进程。


## 内核进程

常见的内核进程如下：
- kthreadd
  - 系统开机时创建的第三个进程，PID 为 2 ，负责管理所有内核态进程。

- kworker
  - 在 CPU 每个核上运行一个实例，用于并行执行内核 Workqueue 中的任务，比如定时器、中断、IO 。

- migration
  - 用于在多个 CPU 核之间迁移运行中的进程，从而避免单核故障、实现负载均衡。
  - 在 CPU 每个核上运行一个实例。

- watchdog
  - 用于避免系统死机。进程启动之后会打开 /dev/watchdog 文件，不断对它进行写操作。如果在一定时间内（默认为 1 分钟）没有进行写操作，就会通过硬件或软件重启系统。
  - 在 CPU 每个核上运行一个实例。

- kblockd
  - 用于管理块设备。
  - 在系统中运行一个实例。

