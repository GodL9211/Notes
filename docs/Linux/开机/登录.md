# 登录

Linux是一个多用户多任务的分时操作系统，用户以用户名和密码（又称为口令）登录后才能使用该系统。
- 用户可通过终端、SSH、图形界面三种方式登录。
- 每创建一个终端时，系统都会先执行login命令，让用户登录。
- 当用户登录之后，系统会根据用户身份分配一个shell，显示一个终端供用户操作。它记作用户的登录shell。
  - 用户执行的命令、创建的子shell都是登录shell的子进程。
  - 当用户退出登录shell之后，系统就会注销用户，回收登录shell，终止它的所有子进程。

## 登录命令

```shell
login <用户名> # 使用指定用户的身份登录，接着要按提示输入密码
```

```shell
logname     # 显示自己的登录用户名（即使用su切换用户也不会改变）
```

```shell
tty         # 显示自己的登录终端名
```

## 查看已登录的用户

命令：

```shell
w         # 显示已登录的所有用户的信息
```

```shell
who       # 显示已登录的所有用户的信息
    am i  # 只显示自己的信息
    -b    # 显示系统的开机时间
    -r    # 显示当前的run level
```

例：

```
[root@Centos ~]# w
 09:40:51 up 11 days, 17:12,  2 users,  load average: 0.00, 0.08, 0.12
USER     TTY      FROM          LOGIN@   IDLE   JCPU   PCPU WHAT
root     pts/0    10.0.0.1      09:44    1.00s  0.01s  0.00s w
root     pts/2    10.0.0.2      Tue09   22:05m  0.20s  0.18s python3
```

显示结果中，每行表示一个已登录的用户的信息，每列的含义如下：
- USER：登录的用户名。
- TTY：登录终端（不是登录后打开的其它终端）。
- FROM：登录IP。
- LOGIN：登录时刻。
- IDLE：用户多久未操作了。
- JCPU：用户正在运行的所有进程的运行时长。
- PCPU：用户正在运行的前台进程的运行时长。
- WHAT：用户正在执行什么命令。

## 查看登录历史

- `/var/log/secure`文件中记录了系统被登录的所有历史（包括登录成功的、登录失败的）。

- `/var/log/wtmp`文件中记录了所有登录成功的历史（包括系统开机）。
  - 它是一个二进制文件，只能用last命令查看。当该文件不存在时，系统就不会进行记录。

- `/var/log/btmp`文件中记录了所有登录失败的历史。
  - 它是一个二进制文件，只能用lastb命令查看。
  - 当该文件不存在时，系统就不会进行记录。
  - 系统会自动定期删除该文件中太旧的记录。

命令：

```shell
last    # 显示所有登录成功的历史记录
```

```shell
lastb   # 显示所有登录失败的历史记录
```

例：

```
[root@Centos ~]# last | head
root     pts/0    10.0.0.1    Wed Nov 20 09:44   still logged in
root     pts/0    10.0.0.1    Wed Nov 20 03:00 - 03:00  (00:00)
root     pts/0    10.0.0.1    Wed Nov 20 02:00 - 02:00  (00:00)
root     pts/0    10.0.0.1    Wed Nov 20 01:00 - 01:00  (00:00)
```

- 显示结果中，每列分别表示：登录的用户名、登录shell、登录IP（如果为空则表示从本地登录）、登录时刻、注销时刻（如果为down则表示直到关机）、登录时长（单位为分钟）。

## 登出命令

```shell
logout      # 在登录shell中使用就会注销用户，在其它shell中使用无效
```

```shell
exit [n]    # 退出当前shell，并可以返回一个状态码（如果退出了登录shell，就相当于logout）
```