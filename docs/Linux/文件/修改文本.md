# 修改文本

## tr

```sh
$ tr <源字符集> <目标字符集>  # 替换文本中的指定字符
     -c                      # 反选源字符集（即选中其它字符）
     -d                      # 删除源字符集
```
- tr 命令的输入不是文件，只能是 stdin ，且输出到 stdout 。
- 例：
    ```sh
    cat f1 | tr a-z A-Z      # 将小写字母换成大写字母
    cat /dev/urandom | tr -cd A-Za-z0-9 | head -c 12 ; echo  # 生成随机密码
    ```

## sed

```sh
$ sed [expression] [file]... # 根据表达式修改文件的内容
      -i                     # 将修改结果保存到源文件中（默认是输出到 stdout）
```
- expression 支持基本的正则语法。
- 常用的几种表达式：
    ```sh
    -n '1p'                  # 显示第 1 行
    -n '1,5p'                # 显示第 1 行到第 5 行（总共显示 5 行）
    '1,$d'                   # 删除第 1 行到最后一行
    '1a hello'               # 在第 1 行之后插入一行字符串

    '/hello/p'               # 找到包含 hello 的所有行并打印
    '/hello/d'               # 找到包含 hello 的所有行并删除

    's/源字符串/目标字符串/g' # 替换字符串
    's/源字符串//g'          # 删除字符串
    's/[^a-z]//g'            # 正则匹配
    's/hello \(\w*\)/\1/g'   # 正则替换
    ```
    - 在正则表达式中，`( )` 要转义成 `\( \)` 。
    - `\1`表示正则匹配的第一组匹配结果。

- 例：
    ```sh
    cat f1 | sed 's/hello//g' > f2  # 将修改结果保存到另一个文件
    sed -i 's/hello//g' f1          # 将修改结果保存到源文件中
    ```

## vi / vim 

vi 是类 Unix 系统的内置文本编辑器，而 vim 是最流行的类 vi 编辑器，功能很多。
- 另外还有 nano ：一个功能简单的文本编辑器，执行命令 `nano` 即可进入。

### 启动

执行以下命令即可启动 vim 编辑器：
```sh
$ vim [path]
```
- 如果不指定 path ，则会打开一个空的编辑器界面。
- 如果指定的 path 是一个文件，则对它进行编辑；如果该文件不存在，则可以在保存时创建它。
- 如果指定的 path 是一个目录，则可以管理该目录下的文件。
- vim 的命令支持组合，可以连续输入多条命令，组合它们的功能。

用 vi/vim 打开一个文件时，会在其目录下生成一个缓存文件，缓存文件的最后修改状态，命名格式为 .{filename}.swp 。
- 如果正常退出 vi/vim ，或者异常退出 vi/vim 但并没有修改文件的内容，该缓存文件就会被自动删除。
- 如果目录下存在该缓存文件，则可能是因为：
    - 此时有其他人正在用 vi/vim 操作该文件。
    - 上一次异常退出 vi/vim 且修改了文件的内容，建议执行以下命令：
        ```sh
        vim -r .{filename}.swp  # 恢复到文件的最后修改状态
        :wq                     # 保存文件
        rm -f .{filename}.swp   # 删除缓存文件
        ```

### 用法

刚启动 vim 时默认进入命令模式命令模式（Command mode）
- 此时不能编辑文本，只能输入键盘上的某些字符作为命令（区分大小写）。
- 文本末尾显示的 `~` 表示空行，并不是实际存在的字符。
- vim 的命令支持组合，可以连续输入多条命令，组合它们的功能。
  - 比如输入一个数字 n 之后再输入 dd ，会连续剪贴 n 行。
- 关于切换模式的命令：
    - `i/a` ：进入插入模式。
    - `o` ：在光标下方插入一行并进入插入模式。
    - `r` ：替换光标所在的那个字符。
    - `R` ：进入替换模式。
    - 输入以 `:`、`/`、`?` 开头的字符串会进入底线命令模式。
    - 进入其它模式之后，按 `Esc` 即可退出到命令模式。
- 关于移动光标的命令：
    - `PageUp` 或 `PageDown` ：向上或下翻页。
    - `k`、`j`、`h`、`l` ：将光标向上、下、左、右移动一格。
    - `Space` ：将光标后移一格。
    - `Enter` ：将光标下移一行。
    - `gg` ：将光标移动到第一行。
    - `G` ：将光标移动到最后一行。
    - 输入 `/word`（或`?word`）会向下（或向上）查找 word 字符串，然后输入 n（或 N）会切换到下一个（或上一个）匹配结果。
- 关于撤销的命令：
    - `u` ：撤销上一次操作。
    - `Ctrl + r` ：重做被撤销的操作。
    - `.` ：重做上一次操作（对 u 和 Ctrl + r 无效）。
- 关于复制粘贴的命令：
    - `yy` ：复制光标所在的当前行。
    - `x` 或 `X` ：删除光标之后或之前的一个字符。
    - `dd` ：剪贴当前行。
    - `p` 或 `P` ：粘贴到下一行或上一行。
    - `v` ：开始选中，此时光标移动过的区域都会被反白选中，然后输入 d 或 y 即可删除或复制。
    - `Ctrl + v` ：开始矩形选中。

底线命令模式（Last line mode）
- 此时输入的字符会显示在下方的命令行中。
- 常用命令：
    - `:wq` ：保存并退出（输入 w 表示保存，输入 q 表示退出）
    - `:wq!` ：强制保存再退出（输入!表示强制执行操作）
    - `:wq [文件名]` ：保存为指定文件。
    - `:set nu` ：显示行号。
    - `:s/源字符串/目标字符串/g` ：替换字符串（目标字符串为空的话就是删除）
    - `/str` ：向下查找字符串。然后输入 n（或 N）会切换到下一个（或上一个）匹配结果。
    - `?str` ：向上查找字符串。
- 可以将 vim 的配置永久保存在 ~/.vimrc 文件中。如下：
    ```
    set nu              # 显示行号（number）
    set encoding=utf-8  # 设置编码格式
    set ignorecase      # 搜索时不区分大小写
    ```
