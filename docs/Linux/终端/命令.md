# 命令

一条命令的基本格式为`<命令名> <option> <argument>`。

- 每个字段之间用空格隔开（多个空格也看作一个空格），区分大小写。
- 在命令的用法说明中，通常用尖括号 `<>` 表示必填字段，用方括号`[]`表示可选字段，用省略号`...`表示该字段可以输入多个。如下：
  ```shell
  ls [OPTION]...
  ping [-c count] [-i interval] destination
  ```
- 在bash中执行命令时，支持使用通配符：* 匹配零个或任意个字符，? 匹配单个字符。如下：
  ```shell
  cat /etc/*-release
  ```

命令名可以是某条内建命令的名字、某个已安装软件的名字，或者某个可执行文件的路径（绝对路径或相对路径）。

option用于选择该命令的一项功能，有长格式（比如 --option ）、短格式（比如 -o ）两种写法。如下：
- 有些短格式的命令行选项可能与某个长格式选项等价，比如-h与--help。但有些命令只有--help选项，没有-h选项；有些命令有-h选项，但不等价于--help选项。
- 多个命令行选项可以组合使用，且不要求顺序，比如"ls -a -l"相当于"ls -l -a 或 ls -al"。

argument可能是传给命令的参数，也可能是传给命令行选项的参数。
- 给命令行选项传入参数时，可以用空格或等号作为分隔符，比如"head -n 3 file"、"head -lines=3 file"。

## 启动命令

执行一条命令，实际上是启动一个程序来实现某种操作。传入的命令参数会被该程序接收。

因此，启动一条命令时，系统会先按以下顺序找到该命令对应的程序：
1. 检查命令名是否为一个有效的文件路径（绝对路径或相对路径），如果是则执行该文件。
2. 检查命令名是否为alias定义的别名。
3. 检查命令名是否为shell的内建命令。
4. 到PATH路径下寻找与命令名同名的可执行文件。
5. 始终没有找到，报错：command not found

环境变量`PATH`记录了一些可执行文件的保存路径，每个路径之间用冒号 : 分隔。如下：

  ```shell
  [root@Centos ~]# echo $PATH
  /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
  ```

- Linux的PATH默认不包含当前目录 . ，因此运行当前目录下的可执行文件时要加上 ./ 前缀。
- 例：添加路径到PATH中：export PATH=$PATH:/root/bin

## 命令的输入、输出

大部分命令都是从stdin读取输入，将输出写到stdout。

- 使用管道符 `|` 可以将上一条命令的stdout作为stdin传给下一条命令，如下：

  ```shell
  cat /etc/*-release | grep Linux
  ```

- 有些命令默认会从stdin读取内容，因此不输入目标参数时可以使用管道符传入上一条命令的输出；有些命令默认不会从stdin读取内容，因此需要使用管道符加xargs命令。如下：

  ```shell
  command | xargs [command]  # 从上一条命令的stdout提取参数（默认合并成一行），输入到下一条命令（默认是echo）
                -n 3         # 每隔三个字段就换行，即每次给下一条命令最多输入三个参数
                -d ','       # 设置字段分隔符（默认是一个或多个空格、Tab）
  ```

## 管理命令

```shell
alias               # 显示所有命令的别名
    <name>          # 显示某个别名的定义语句
    cd1="cd ~"      # 定义一个别名

unalias <name>      # 取消一个别名

man <name>          # 显示命令的使用手册（manual），这会打开less阅读器

type <name>...      # 显示一个命令名的类型（还会显示该命令名的二进制文件的位置）

which <name>...     # 显示该命令的可执行文件的绝对路径（在PATH路径下寻找，显示第一个找到的）
    -a              # 显示该命令的所有可执行文件
    -i              # 考虑alias别名

whereis <name>...   # 显示该命令的可执行文件、源代码、manual文件的绝对路径（在PATH、MANPATH路径下寻找）
```

## 历史命令

用户输入的历史命令会保存为一个列表，每次用户注销后会保存到 ~/.bash_history 文件中，执行history命令即可查看。

```shell
history    # 显示历史命令
    -c     # 清空本次登录以来的历史命令
    -w     # 将本次登录以来的历史命令保存到 ~/.bash_history文件中
```

可通过以下快捷方式执行历史命令：

```shell
!!         # 执行上一条命令
sudo !!    # 以root用户的身份执行上一条命令
!n         # 执行历史记录中的第n条命令
!$         # 获得上一条命令的最后一个参数
```
