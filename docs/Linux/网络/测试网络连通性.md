# 测试网络连通性

## ping

常用于测试网络是否连通、网络延迟、域名解析。

原理：
- 基于ICMP协议，向目标主机发送ICMP报文，根据收到回复的时间间隔就可以知道通信延迟。
- ICMP报文的头部用1个字节记录了该报文的生存期（Time To Live，TTL）。
- ICMP报文每经过一跳路由器，TTL的值就会被减一，当TTL为零时路由器就会丢弃该报文。

命令：

```shell
ping <host>  # 启动ping
    -c n     # 最多发送ICMP报文多少次（默认为无限次）
    -i n     # 每次发送ICMP报文的间隔时间（默认为1秒）
    -I eth0  # 使用本机的指定网卡来发送ICMP报文（默认自动选取网卡）
```

- host可以是IP地址或域名，如果是域名，在执行时还会显示出域名解析后的IP地址。

例：

```shell
[root@Centos ~]# ping baidu.com
PING baidu.com (39.156.69.79) 56(84) bytes of data.
64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=1 ttl=250 time=37.0 ms
64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=2 ttl=250 time=37.0 ms
64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=3 ttl=250 time=37.0 ms
64 bytes from 39.156.69.79 (39.156.69.79): icmp_seq=4 ttl=250 time=37.0 ms
^C
--- baidu.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3003ms
rtt min/avg/max/mdev = 37.008/37.022/37.044/0.136 ms
```

- 可见它成功连接到目标主机，显示出ping的测试结果。
- icmp_seq：表示这是第几个ICMP报文。
- ttl：ICMP报文剩下的生存期。
- time：发出ICMP报文之后，隔了多久才收到回复。
- Linux的ping命令默认每隔一秒向目标主机发送一个ICMP报文，并且会一直发送，要按 `Ctrl+C` 终止。

例：

```shell
[root@Centos ~]# ping google.com
PING google.com (93.46.8.90) 56(84) bytes of data.

^C
```

- 可见它一直尝试连接目标主机，但并没有成功。原因可能是：
  - 与目标主机的网络不通
  - 与目标主机的网络连通，但是目标主机没有开启ICMP协议

## telnet

一个传统的远程登录工具，通信内容没有加密，因此不安全。现在常用于测试TCP端口是否连通。

命令：

    telnet <host> [port]   # 连接到某个主机的TCP端口（默认是23端口）

例：

```shell
[root@Centos ~]# telnet baidu.com 80
Trying 39.156.69.79...
Connected to baidu.com.
Escape character is '^]'.
```

- 可见它成功连接到目标主机的80端口。此时按 `Ctrl+]` 和 `Ctrl+D` 即可断开连接。

例：

```shell
[root@Centos ~]# telnet 127.0.0.1 8000
Trying 127.0.0.1...
telnet: connect to address 127.0.0.1: Connection refused
```

- Connection refused说明与目标主机的网络连通，但是连接不到目标端口。原因可能是：
  - 目标主机的防火墙拦截了发向该端口的数据包
  - 目标主机的防火墙开通了该端口，但是目标主机上没有进程在监听该端口
- 上方访问的目标主机是本地环回地址，不会被防火墙拦截，所以是第二种原因。

例：

```shell
[root@Centos ~]# telnet baidu.com
Trying 220.181.38.148...

^C
```

- 可见它一直尝试连接目标主机的23端口，但并没有成功。原因可能是：
  - 与目标主机的网络不通
  - 端口无响应

## traceroute

查看发送一个数据包到目标主机时，要经过哪些路由。

命令：

```shell
    traceroute <host>
```