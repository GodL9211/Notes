# 哈希算法

：Hash algorithm ，又称为散列函数。用于将一段数据映射到一个值，称为散列值、哈希值、摘要值。
- 哈希算法存在多种类型，通常将哈希算法用于加密领域，不过也有图片哈希算法等其它类型。

## 加密哈希算法

常见的几种加密哈希算法：
- MD5 ：消息摘要算法（Message-Digest Algorithm）
  - 于 1992 年发布，生成 128 位的哈希值。
  - 安全性很差，容易被碰撞攻击。但生成速度快，常用于非正式环境。

- SHA ：安全哈希算法（Secure Hash Algorithm）
  - 由美国国家安全局发布，分为几个版本。
  - SHA-1 ：于 1995 年发布，会生成 160 位的哈希值。安全性较差，可能被碰撞攻击。
  - SHA-2 ：于 2001 年发布。常用的是 SHA-256、SHA-512 ，分别生成 256、512 位的哈希值。安全性更高，但是生成速度较慢。
  - SHA-3 ：于 2015 年发布。

这几种哈希算法的用法基本相同，它们的共同特点包括：
- 输入一段任意长度的二进制数据，生成一个固定长度的、取值难以预测的的二进制值。
  - 通常将哈希值表示成十六进制格式，便于阅读。
  - 例如处理字符串、处理图片等文件时，通常先转换成二进制流，再计算其哈希值。
- 如果两个数据的内容相同，则它们的哈希值一定相同。
  - 在计算机上编辑图片等文件时可能会自动加上时间信息等内容，导致最后保存的文件内容看起来一样，实际上二进制数据并不一样，因此哈希值不同。
- 如果两个数据的内容不同（即使只有一个 bit 的差异），则它们的哈希值几乎总是不同。
  - 如果相同，则称为发生碰撞。哈希算法的碰撞率越低越好。
  - MD5 只生成 128 位的哈希值，因此碰撞率比 SHA256 高。
- 如果只知道一个数据的哈希值，则几乎不可能据此反推出数据的原始内容。
  - 因为理论上生成同一个哈希值的原数据可能有无数种。想反推出原数据，除非哈希算法存在容易被反推的缺陷，或者建立一个庞大的数据库，存储常见的一些数据的哈希值。

加密哈希算法常用于：
- 数据的一致性检验。
  - 例如根据一个文件的哈希值是否变化，能判断该文件的内容是否改变。
- 以密文形式存储密码。
  - 例如 Web 服务器不储存用户的明文密码，而是储存密码的哈希值。如果用户输入的密码的哈希值与数据库中存储的哈希值一致，则判断密码正常。这样连网站管理员都看不到用户的明文密码，避免泄露。
  - 不过这本身并不属于加密，从密码的哈希值不能还原出明文密码。

## ♢ Hashlib

：Python 的标准库，提供了实现 MD5、SHA1、SHA256、SHA512 等常见哈希算法的函数。
- 例：
  ```py
  >>> import hashlib
  >>> h = hashlib.sha256()          # 创建一个 Hash 对象
  >>> h.update("Hello".encode())    # 输入要 Hash 的内容（必须转换成 bytes 类型）
  >>> h.update("World".encode())    # 可以累加
  >>> h.digest()                    # 生成哈希值（ bytes 类型）
  b'\x87.NP\xce\x99\x90\xd8\xb0A3\x0cG\xc9\xdd\xd1\x1b\xeckP:\xe98j\x99\xda\x85\x84\xe9\xbb\x12\xc4'
  >>> h.hexdigest()                 # 生成十六进制的哈希值（ str 类型）
  '872e4e50ce9990d8b041330c47c9ddd11bec6b503ae9386a99da8584e9bb12c4'
  >>> hashlib.sha256("HelloWorld".encode()).hexdigest()      # 可简化成一步
  '872e4e50ce9990d8b041330c47c9ddd11bec6b503ae9386a99da8584e9bb12c4'
  ```
- 在哈希时加盐：
  ```py
  import os
  salt       = os.urandom(10)       # 生成指定字节数的随机 bytes 对象
  password   = '123456'.encode()
  Hash_bytes = salt + password
  result     = hashlib.sha256(Hash_bytes).hexdigest()
  ```
  - 用 Python 的 random 模块生成的随机数是不安全的，此处应该用 os.urandom() 函数生成随机数。
 
## ♢ hmac

：Python 的标准库，提供了实现 hmac 算法的函数。
- MAC 算法是使用密钥的哈希算法。
- hmac 算法使用一个 key 搭配某个哈希算法对消息进行加密，比单纯的哈希加盐更难以预测。
- 例：
    ```py
    >>> import hmac
    >>> key = os.urandom(10)
    >>> msg = '123456'.encode()
    >>> hmac.new(key, msg, 'sha256').hexdigest()
    '62f33c9d8af25adb6ca6180f9351618084de7d95d5f2689489700f48f982bae6'
    >>> hmac.compare_digest(b'123', b'123')    # 比较两个哈希值是否相同
    True
    ```
