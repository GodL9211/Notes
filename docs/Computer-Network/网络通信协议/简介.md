# 简介

网络通信协议：主机之间进行通信时需要遵守的规则。
- 网络通信协议有很多种，用途也不同。例如：网络层的ARP协议常用于主机寻址，应用层的HTTP协议常用于Web服务。

## 服务器

：指网络中的某些主机，可以为其它主机提供某种服务。
- 服务器通常要保持运行，以持续提供服务。
- 不同用途的服务器通常采用不同的通信协议，比如采用FTP协议时，称为FTP服务器。

服务器常见的几种工作模式：
- 客户端/服务器模式（Client/Server，C/S）
  - 运行一个或多个主机作为服务器，再运行一个或多个主机作为客户端。
  - 客户端连接到服务器之后，便可以享受到其提供的服务。
- 浏览器/服务器模式（Browser/Server，B/S）
  - 浏览器可实现客户端的功能，而且使用更方便、更通用，例如Web浏览器。
- 对等网络（Peer to Peer，P2P）
  - 通信的主机之间互为客户端与服务器，以对等方式传输数据。
  - 线上到线下（Online to Offline，O2O）的名字与P2P相似，但概念不同。

## ARP

：地址解析协议（Address Resolution Protocol），可以根据主机的IP地址查询到它的MAC地址，常用于局域网的主机寻址。
- 属于网络层协议。

## ICMP

：因特网控制报文协议（Internet Control Messages Protocol）
- 属于网络层协议，基于IP协议寻址。
- ping工具就是通过发送ICMP数据包来测试网络的连通性。
  - ICMP协议不是基于TCP协议进行通信，因此不必考虑目标主机是否开放了某个TCP端口。
  - 如果用ping工具不能连接到目标主机，可能是物理网络没有连通，也可能是目标主机没有启用ICMP协议。

## DHCP

：动态主机配置协议，用于给一些主机动态分配IP地址，广泛应用于企业单位的局域网中。
- 属于应用层协议，基于UDP通信。
- IP地址的分配方法分为静态和动态两种。手动配置主机的IP就属于静态分配。
- 客户端使用DHCP服务的过程分为以下四步：（此时客户端与服务器通过UDP协议通信，一般使用受限广播报文）
  - Request：客户端广播“DHCP discover”报文。
  - Reply：服务器收到discover报文后会广播“DHCP offer”报文，包括准备分配的IP地址、默认网关等信息。
  - Request：客户端收到offer报文后就广播“DHCP request”报文，表示请求使用这个IP地址。
  - Reply：服务器收到request报文后就广播“DHCP ack”报文即确认报文，将IP地址分配给客户端。
- DHCP服务器的主要配置内容：
  - 作用域：指DHCP服务器所管理的IP地址的范围，通常为一个连续网段。
  - 排除范围：指作用域内一些不被DHCP服务器分配的IP地址。
  - 地址池：作用域内排除掉不分配的IP地址，剩下的就是地址池。
  - 租约：客户端只能租用IP地址一段时间。

## NAT

：网络地址转换（Network Address Translation）
- 工作原理：
  - SNAT（Source NAT）：当NAT网关收到私网主机向公网发送的IP包时，将IP包中的源IP地址从私网IP转换成公网IP，然后转发到公网。
  - DNAT（Destination NAT）：当NAT网关收到公网发来的IP包时，将IP包中的目的IP从公网IP转换成私网IP，然后转发给对应的私网主机。
- NAT网关一般是一台服务器，工作在网络层（与proxy不同）。
  - NAT网关内至少有两张网卡，分别连接私网和公网。
  - NAT网关一般给私网内的主机分配10.0.0.0、172.16.0.0、192.168.0.0三种范围的专有网络地址，并保存一些可用的公网IP地址。
  - NAT网关上维护了一张NAT表，记录了每个私网IP与公网IP的转换关系。如果经过NAT网关的IP包中的IP地址不在NAT表中，就丢弃该报文。
- NAT网关的分类：
  - 静态NAT(Static NAT)：NAT表事先写好，不再变化。这样可以直接实现DNAT。
  - 动态地址NAT(Pooled NAT)：NAT表可以动态变化。这样不能实现DNAT。
  - 端口多路复用（Port Address Translation，PAT）：所有私网主机共用一个外网IP，只是连接到NAT网关的不同端口上。NAT网关与公网通信时，使用的不同端口号代表了不同的私网主机，转换IP包中的IP地址和端口号。
