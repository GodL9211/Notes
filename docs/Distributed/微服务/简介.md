# 简介

## 微服务

：Microservices ，一种服务器架构，将业务系统从单个大型程序，拆分成多个小型程序，称为微服务。
- 优点：
  - 将复杂的大型程序拆分成微服务架构，有利于模块化开发，降低复杂度。
  - 每个微服务作为一个独立程序运行，低耦合。微服务之间通过 TCP、HTTP 等协议通信，甚至可以采用不同的编程语言。
  - Docker 技术流行之后，微服务变得容易部署。通常将每个微服务部署到一个 Docker 容器中，用 k8s 编排。
- 缺点：
  - 微服务架构存在一定难度，比如要提供服务发现机制、维护分布式系统。
  - 微服务之间的网络通信，比单体服务的内部函数间调用更久，增加了业务处理耗时。

- 从头搭建微服务系统很麻烦，通常使用开源的微服务框架。例如：
  - Spring Cloud
    - ：一个 Java 框架。微服务之间通过 RESTful API 进行通信，性能比 RPC 低。
  - Dubbo
    - ：一个 Java 框架，由阿里巴巴公司发布。微服务之间通过 RPC 协议进行通信。

## API Gateway

- 单体服务通常对外暴露的 API 少。而微服务之间需要相互调用，存在大量 API ，因此通常用 API 网关来统一管理。例如：
  - Zuul
    - ：由 Netflix 公司开源，成为了 Spring Cloud 自带的组件。
    - 性能较差，因此出现了试图取代它的新项目 Spring Cloud Gateway 。
  - Kong
    - ：一个基于 OpenResty 服务器的网关。
    - 提供了 4 层代理（TCP/UDP）、7 层代理、动态路由、健康检查、限流、身份认证、权限控制、日志等功能。
  - APISIX
    - ：一个基于 OpenResty 服务器的网关。借鉴了 Kong ，但功能更多、性能更好。

## Service Mesh

：服务网格， 2016 年提出的一种微服务技术。
- 特点：
  - 在服务器增加一个网络代理层，处理各个微服务收、发的网络流量，比如过滤、修改网络包。并提供服务发现、负载均衡等功能。
  - Spring Cloud 等微服务框架只适用于特定的编程语言，还需要修改业务代码来适配。而 Service Mesh 属于透明代理，与编程语言无关，不侵入业务代码，即可管理网络流量。因此可将传统程序直接迁移到服务网络中，变为微服务架构。
- 几种框架举例：
  - Envoy ：2016 年，由 Lyft 公司发布，后来捐赠给 CNCF 基金会托管。采用 C++ 开发。
    - Envoy 的核心是一个透明代理软件，支持代理 TCP、UDP、HTTP、gRPC 等多种协议的流量。还提供了服务发现、健康检查、负载均衡等功能。
  - Linkerd ：2016 年，由 Buoyant 公司发布。采用 Golang 开发。
  - Istio ：2017 年，由 Google、IBM、Lyft 公司联合发布。采用 Golang 开发，基于 Envoy 代理流量。
  - Consul Connect ：2018 年，由 HashiCorp 公司发布，作为 Consul 的新功能。

## 相关概念

- 南北流量（North-South traffic）
  - ：指客户端与服务器之间的网络流量。因为绘制网络架构图时，通常服务器、客户端分别位于上下两侧。
- 东西流量（East-West traffic）
  - ：指服务器内部，各个服务之间的网络流量。
  - 对于微服务架构，东西流量比南北流量更复杂、流量更大。
  - API Gateway 擅长处理南北流量，但也可处理东西流量。Service Mesh 擅长处理东西流量，但也可处理南北流量。
