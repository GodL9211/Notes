# 云计算

在传统模式下，用户想部署一个 Web 网站时，需要自己购买服务器裸机，然后安装操作系统、服务器软件，最后才能部署 Web 网站。
在云计算时代，用户可以直接使用云服务商提供的服务器、软件，省掉一些亲自动手的工作量。

## 服务模式

云计算的服务模式包括：
- IaaS ：基础设施即服务（Infrastructure as a Service），云端提供一些基础设施供用户使用，比如服务器裸机。（这里的用户一般是指 IT 技术人员）
- Paas ：平台即服务（Platform as a Service），云端提供一些平台供用户使用，比如已安装操作系统的服务器。
- SaaS ：软件即服务（Software as a Service），云端提供一些软件供用户使用。比如电商网站。（这里的用户可以是 IT 技术人员，也可以是普通消费者）
- BaaS ：后端即服务（Backend as a Service），云端提供一些后端服务供用户使用，比如数据库、对象存储。
- FaaS ：函数即服务（Function as a Service），云端可直接运行用户编写的函数代码。
  - FaaS 将应用拆解成比微服务更小的单位，且具有无状态、即写即用等特点。

## VPC

：虚拟私有云（Virtual Private Cloud），是指在云平台中划分出一个独立网段，与云平台中的其它 IP 之间网络隔离，从而给某个用户或企业私自使用。
- 在 VPC 中还可以再划分子网，但这些子网之间并没有网络隔离，只要添加了路由表就能相互通信。

VPC 内部的主机与外部通信的方法：
- 可以给 VPC 添加 NAT 网关，让 VPC 能与公网通信。此时网络包的流向为：VPC 主机 → NAT 网关 → 公网主机 。
- 可以给 VPC 添加 VPN ，让 VPC 能与本地网络通信。此时网络包的流向为：VPC 主机 → VPC 网关 → 公网中转 → VPN 服务器 → 公网中转 → 本地网关 → 本地主机 。
- 可以给 VPC 中的一个主机绑定外部某个网络的 IP ，使其能够与该网络的主机通信。这个 IP 在不用的时候可以解绑，因此称为“弹性 IP”。
  - 例如，使用弹性公网 IP ，就可以让 VPC 中的主机与公网通信。
  - 一个弹性 IP 只能让 VPC 中的一个主机与外部通信，而一个 NAT 网关可以让 VPC 中的所有主机与外部通信。
  - 如果将一个弹性公网 IP 给 NAT 网关使用，就可以让 VPC 中的所有主机都能访问公网。

下图是腾讯云的网络架构：

![](./frame.jpg)

- CVM 部署在 region1 的 VPC 中，不具备公网 IP ，不能主动与公网通信，对外网不可见。
- 当公网中的主机主动访问集群时，要将请求发送到 LBS 的公网 IP 地址、80 端口。
  - LBS 会将从 80 端口收到的流量转发给 VPC 中的几个 CVM——将数据包的目的 IP、目的端口改为某台 CVM 的内网 IP、端口。CVM 收到该包之后，会把它转发到相应的容器端口。
  - 当 CVM 处理完请求之后，会将回复的数据包通过 LBS 返回给公网的主机。
- 当 CVM 主动访问公网时，要将请求发送到 NAT 网关，由 NAT 网关进行代理。
- 当 CVM1 主动访问同一个 VPC 内的另一个 CVM2 时，需要先配置从 CVM1 到 CVM2 的路由表。
- 当 CVM1 主动访问另一个 VPC 内的 CVM 时，需要先通过“对等连接”功能将两个 VPC 的网络连通，然后配置两个 VPC 之间的路由表。

## 其它概念

- VPS ：虚拟专用服务器（Virtual Private Servers），又称为虚拟机。可以在一台物理服务器上通过 Hypervisor 技术运行多个虚拟服务器，分配给多个用户私自使用。
- CVM ：云虚拟机（Cloud Virtual Machine），是指云平台提供的 VPS 。
- OpenStack ：一个开源的云平台框架，基于 Python 开发，常用于搭建云平台并管理服务器等资源，提供 IaaS 服务。
- 云原生（Cloud Native）：将软件的开发、测试、运维等过程都迁移到云平台上进行，利用云平台的优势。
