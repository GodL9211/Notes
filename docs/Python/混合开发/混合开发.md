# 混合开发

多种编程语言混合开发的形式：
- 调用可执行文件。
- 每种语言分别运行一个进程，让它们通信、协作。（通过本机socket或HTTP协议通信）
- 调用代码（比如调用函数、类）。

本文研究Python与C/C++的混合开发中，如何调用代码。
- Python调用C/C++代码的形式：
  - 把C/C++代码编译成C/C++的动态链接库，再被Python导入。
  - 把C/C++代码封装成Python的扩展模块，再被Python导入。
- C/C++调用Python代码的形式：
  - 把Python代码转换成C/C++的动态链接库，再被C/C++导入。
  - 把Python代码转换成C/C++的源文件，再被C/C++导入。

## 混合开发工具

混合开发工具有多种，选择它们时需要考虑的主要问题如下：
- 是否支持C/C++调用Python？或者反之？
- 调用函数时，是把形参从Python的数据类型转换成C/C++的数据类型，还是反之？
- 进一步地，哪些数据类型可以通用？哪些数据类型不兼容？
- 能否调用类？
- 如果C/C++代码抛出了异常，如何传递给Python？或者反之？
- 能否移植到Linux、Windows等多种平台？

常见的混合开发工具：

- `Python的C API`：可以将C/C++代码封装成Python模块，或者将Python代码封装成C代码。
  - 优点：
    <br />它是实现Python混合开发的底层API，是其它混合开发工具的基础。
    <br />Python自带的功能，不需要安装第三方库。
  - 缺点：
    <br />使用时很麻烦。

- `ctypes`：Python的标准库，允许Python加载C的动态链接库，直接调用其中的函数，或者将Python函数作为回调函数传给C函数。
    - 优点：
    <br />Python自带的功能，不需要安装第三方库。
    <br />使用时不需要封装C代码，可以直接调用C的动态链接库。
    - 缺点：
    <br />没有封装C函数，因此Python调用一个C函数时要自己转换数据类型。
    <br />只支持C语言，处理C++代码时要先封装成C函数。
    <br />不支持C/C++主动调用Python。

- `Cython`：Python的第三方库，可以将C代码封装成Python模块，或者将Python代码编译成C代码。
  - 优点：
    <br />可以在Python中使用C/C++的数据类型、函数，扩展Python的语法，提高Python程序的运行效率。

- `SWIG`：一个编译器，可以将C/C++代码封装成供C#、Java、Python等多种语言调用的文件。
  - 缺点：
    <br />不支持C/C++主动调用Python。

- `Boost.Python`：一个C++库，可以将C++代码封装成Python模块，或者在C++中导入Python模块。
  - 缺点：
    <br />使用时比较麻烦。

- `pybind11`：一个C++库，相当于轻量级的Boost.Python。
  - 优点：
    <br />比较轻量级，使用时只需要导入一个头文件。
    <br />对C/C++代码的封装比较完善，能加上模块说明、函数说明。
