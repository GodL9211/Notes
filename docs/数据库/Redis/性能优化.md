
# 性能优化

- Redis的QPS主要受网络延迟、CPU频率影响。
- Redis的读写速度很快，IO压力小。因此没有必要读写分离，只是需要横向扩容。
- 当系统内存不足时，Redis会卡顿，甚至可能被OOM杀死。

## redis-benchmark

：Redis官方提供的性能测试工具，安装Redis时会自带。

命令：
```shell
$ redis-benchmark
                  -h 127.0.0.1 # redis服务器的IP地址
                  -p 6379      # redis服务器的端口号
                  -a ******    # 密码

                  -c 50        # 模拟连接的client数（默认50个）
                  -n 100000    # 模拟发出的请求数
                  -l           # 循环测试，不停止
                  -d 3         # set、get时的value大小（默认为 3 bytes）
                  -r 10000     # 使用随机的名字创建key
                  -t set,get   # 只执行某些测试用例（默认执行所有测试用例）
                  -P 10        # 使用管道，每次通信发送10条命令（默认只发送一条）
```
- 例：
  ```shell
  redis-benchmark -h redis-1 -a ****** -t set,get
  ```
- 测试的是QPS，不会创建多少key、占用多少内存。
- 当 -c 太少时，QPS会比较小。当QPS达到瓶颈时，增加 -c 数，QPS也不会增加。
- 测试时会在Redis服务器的 0 号数据库中创建几个key，比如`mylist`、`key:__rand_int__`等。测试完之后不会删除。
- 使用 -r 10000 选项时，会使用10000范围内的随机数给key命名，例如：`key:000000000913`、`key:000000000882`
