# 管理单元

MySQL的管理单元从上到下依次分为：
- **database** ：数据库
  - 一个MySQL实例中可以创建多个数据库。
- **table** ：数据表
  - 一个数据库中可以创建多个数据表。
  - 创建数据表时会定义它包含哪些列（column）。因此，插入一行数据时，需要包含与每列对应的字段（field）。
- **row** ：数据行
  - 一个数据表中可以插入多行数据。
  - 可以单独修改一行数据中的某个字段，但是删除时只能删除这一整行。

## 数据库

```sql
show databases;        -- 显示所有数据库（只会显示名字）
use <db>;              -- 切换到指定数据库

create database <db>;  -- 创建一个数据库
drop database <db>;    -- 删除一个数据库
```

## 数据表

### 查

```sql
show tables;                  -- 显示当前数据库的所有数据表
show table status\G;          -- 显示所有数据表的状态
show full columns from <tb>;  -- 显示指定数据表中所有列的配置信息
```
- 切换到一个数据库之后，就可以直接访问该数据库的数据表。否则每次操作数据表时，都需要指明是哪个数据库。如下：
    ```
    show tables from <db>;
    show full columns from <db.tb>;
    ```

### 增

创建数据表：
```sql
create table if not exists tb1(         -- 创建一个数据表，名为tb1，并且当它不存在时才创建它
    id int unsigned auto_incremend,     -- 定义一个字段，名为id，采用无符号整型，并且每次插入的新数据行中，id值会自动加一
    primary key (id),                   -- 将id字段声明为主键
    name varchar(100) not null,         -- 定义一个字段，名为name，采用varchar类型（占100字节），并且不允许值为null（否则报错）
    time date                           -- 定义一个字段，名为time，采用date类型
)engine=InnoDB default charset=utf8mb4; -- 设置存储引擎为InnoDB，默认字符集为utf8mb4
```
- 创建的数据表中至少要包含一个列。
- 创建数据表时，建议给每列设置默认值，并且不允许值为null。
  - MySQL中的null是一个特殊的值，比空字符更占存储空间，不能使用通用的查询语句，还不利于索引优化。
- 主键：表中每行数据的唯一标识。
  - 每行数据的主键字段的值在表中都是唯一的，便于辨识每行数据。
  - 主键可以是某个字段，也可以是多个字段的组合。
  - 一张表中只能定义一个主键。





- 创建临时表：
create temporary table <tb> (...);
  - 当客户端关闭连接时临时表就会被销毁，也可以主动删除临时表：
drop table <tb>
  - 临时表不能通过show命令查看。

- 拷贝一张表：
create table tb2 like tb1;      # 拷贝表结构
insert into tb2 select * from tb1;    # 拷贝每行数据
  - 也可以查看创建某个表的create命令，然后稍作调整。
show create table <tb>;


### 改

```sql
alter table tb1 rename to tb2;        -- 修改数据表的名字
alter table tb1 engine = myisam;      -- 修改数据表的引擎

alter table tb1 add time date;        -- 添加一个列（默认排在最后一列），并设置列名、数据类型
                [FIRST]               -- 排在第一列
                [AFTER <field>]       -- 排在指定列之后
alter table tb1 change time `t` date; -- 将time列改名为t，数据类型为date
alter table tb1 modify time char(10); -- 修改time列的数据类型
alter table tb1 drop time;            -- 删除一个列
```

### 删

```sql
drop table <tb>;      -- 删除数据表
truncate table <tb>;  -- 清空数据表的内容（不影响数据表的结构）
```

## 数据行

### 增

```sql
insert into 表名 (字段名,...)  # 指定要写入哪几个字段
                  values
                  (字段值,...);    # 给这几个字段依次赋值
```
# 也可以不指定要写入的字段，直接写入一行数据的所有字段
insert into tb1 values (null, "AA", "2012-12-01");  # 即使不写入id字段，它也会自动递增）
  - 设置了auto_incremend的字段不必写入，它会自动递增。


### 查

```sql
select 字段名... from 表名... [where ...]
[order by 字段名 [desc]]    # 按某个字段排序（或降序）
[limit <n,m>]  # 从筛选结果的第n条开始显示，最多显示m条
  - select * from tb1;    # 用通配符 * 显示所有字段，不加where子句就会返回所有行数据
  - select * from tb1 where name = "AA";        # 严格查询
# where name in ("AA", "BB");    # 多组查询
# where name = "AA" or id >5;    # 支持and、or表达式
  - select * from tb1 where name is null;      # 判断null值要用is null或is not null
              # 不能用 name=NULL，因为在MySQL中它总是返回False
  - select * from tb1 where name like "a_%";    # 模糊查询（不区分大小写）
# _ 匹配单个字符，% 匹配任意个字符
  - select * from tb1 where name REGEXP "^AA$";    # 使用正则表达式
```

### 改

```sql
update 表名 set 字段名=字段值... [where ...]
```

### 删

```sql
delete from <tb>;        # 删除数据表的全部内容（相当于truncate table）
delete from <tb> where ...;  # 筛选出一部分数据再删除
```
- delete命令不会立即释放磁盘空间，还可以回滚。
