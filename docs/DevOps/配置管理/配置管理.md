# 配置管理

## 配置管理方案

：用于管理项目的各种配置信息，保证部署项目时能达到预期效果。

一种通用的配置管理方案：
- 将项目的各种配置信息记录在文档中，再将该文档存储在 Git 仓库中。
- 每次变更配置信息时，就提交一个新版本，需要记录变更原因。必要时还需要经过人工审核才能批准变更。
- 记录每个历史版本的配置信息，保证能让项目回滚到某个历史状态。

项目的配置信息分为多个方面：
- 源代码
  - 用 Git 或 SVN 服务器管理。
- 构件产物
  - 用各种仓库管理，比如二进制文件存储到 Artifactory 服务器，jar 包存储到 Nexus 服务器，Docker 镜像存储到 Harbor 服务器。
- 运行环境
  - 比如运行项目需要的操作系统、依赖软件。
  - 如果项目部署在虚拟机上，可通过 Ansible 批量管理主机的运行环境。
  - 如果项目部署在容器中，则通过 Dockerfile 配置运行环境。
- 配置文件
  - 配置文件可能包含服务器密码等重要信息，因此不适合存储在源代码仓库中，应该单独存储。
  - 静态配置文件：不需要实时更新，可以存储到 Git 仓库中，需要用时再手动提取。
  - 动态配置文件：需要实时更新，可以通过 Nacos 快速上传、下载配置。

## 配置管理工具

- Ansible
  - 通过 shell 命令操作，以 SSH 方式控制远程主机，可以传输文件、执行任意命令。
- Saltstack
  - 与 Ansible 原理类似，但提供了 Web UI 。
- Puppet
  - 提供了 Web UI 。
- Chef
  - 提供了 Web UI 。
  - 周期性执行，只适合静态配置，不适合动态配置。
- Fabric
- Apollo ：采用 Java 开发，由携程公司开源。
- Nacos ：兼有配置管理、服务发现功能。

## 服务发现工具

- Zookeeper
- etcd
  - k8s 就是采用 etcd 存储服务信息。
  - 一种方案：用 etcd 存储服务信息，用 registrator 注册服务并保存到 etcd 中，用 confd 读取 etcd 并生成配置文件。
- Consul
- Eureka
