# 配置管理

k8s中管理yaml配置文件的常用工具：
- helm
- Kustomize

## Helm

一个命令行工具，用于管理k8s中的应用。
- 类似docker，但管理级别更高。
- 将k8s中一个应用的相关配置文件打包成一个 .tgz 文件，称为 Chart 。
  - charts可以存储在本机，或者存储到远端仓库。
- 采用 C/S 架构。
  - 客户端名为 Helm ，负责管理charts。
  - 服务器名为 Tiller ，收到客户端的请求后，根据chart生成release文件，然后传给k8s的apiserver。

命令：
```shell
helm
    ls              # 显示所有已部署的应用

    create <name>   # 创建一个Chart目录
    package <dir>   # 将一个Chart目录打包，这会生成一个 .tgz 文件
    install <name>  # 将一个Chart部署到k8s
    uninstall <name>
    status <name>
    inspect <name>  # 查看Chart的详细信息

    search <name>   # 在 Helm Hub 中查找Chart
```

### 制作Chart

Chart 的目录结构：
```
app/
├── Chart.yaml          # 描述该Chart的信息
├── templates/          # 存放该应用的配置文件
│   ├── deployment.yaml
│   └── service.yaml
├── values.yaml         # 用于给templates中的变量赋值
├── requirements.yaml   # 描述当前Chart依赖的其它Chart
├── charts/             # 存放当前Chart依赖的其它Chart
├── LICENSE
└── README.md
```

Chart.yaml的示例：
```yaml
name: redis
apiVersion: v1
version: 0.0.1
description: A Helm chart for Kubernetes
```

values.yaml的示例：
```yaml
image:
  repository: myharbor.com/test/redis
  tag: 5.0.6
```

在deployment.yaml中使用values的示例：
```yaml
template:
  spec:
      containers:
      - image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
      ...
```

## Kustomize

,,,
