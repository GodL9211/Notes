# 简介

## 监控策略

- 采用监控工具取代人工巡检，可以更直观地查看系统状态、记录日志，更及时地发现异常。
- 常见的监控指标：
  - CPU 使用率
  - 内存容量
  - 磁盘容量
  - 磁盘 IO 速率
  - 网络 IO 速率
  - 项目进程的数量
    - 建议项目进程提供一个 HTTP API 供监控工具访问，从而反馈自己是否健康。
- 如果开销不大的话，把冷门的指标也采集了，有备无患。
- 将不同的监控指标用不同的颜色标明：
  - 绿色：代表良好状态，或者取值越大越好的指标。
  - 灰色：代表不需要关注。
  - 蓝色：代表正常状态，但是取值越小越好的指标。
  - 黄色：代表轻微异常，可以忽视。
  - 橙色：代表明显异常，需要处理。
  - 红色：代表危险状态，需要立即处理。
- 关于图表显示：
  - 文本：适合只需关注当前时刻值的指标。
  - 曲线图：适合每秒都在变化的指标。
  - 条状图：适合几分钟才变化一次的指标。
  - 饼状图：适合总量固定的多个指标，表示百分比关系。在 Grafana 中，可以用启用 stack 选项的曲线图，表示多个指标随时间变化的百分比关系。

## 告警策略

- 当监控系统发现某个指标的值不符合预期时，应该标识为异常状态，并发送警报（Alert）。
- 发送警报的策略：
  - 允许暂停发送警报，便于调试。
  - 在 m 时长内 n 次满足告警条件，才发送警报，从而减少误报。
  - 发送一个警报之后，如果一直满足告警条件，则需要间隔一段时间才能重复发送，从而避免告警风暴。
  - 尽量对警报去重，比如同一应用的不同实例共用一个警报、同一对象的严重警报会覆盖不严重警报。
  - 当告警解除时，应该再发送一个消息通知用户。
- 应该为警报划分几种严重等级，例如：

  等级  | 含义         | 处理措施            | 通知人
  -     |-            |-                    |-
  FATAL |致命、很严重  |紧急，需要立即处理     |通过短信、电话等方式通知相关负责人，甚至更高级的负责人
  ERROR |错误         |需要处理，但并不紧急   |通过邮件发送给相关负责人
  WARN  |警告         |可以忽略，可以不处理   |默认发送给相关负责人
  INFO  |提示         |可以忽略，相当于日志   |默认不会发送

- 处理警报的策略：
  - 对于反复出现的告警，应该尝试用脚本自动化解决，比如当进程异常退出时自动重启。
  - 使用一个告警平台，统一接收不同来源的警报（比如 HTTP 、SMTP 方式的警报），然后按自定义的告警策略转发出去。
  - 每条警报应该记录这些信息：简短标题、具体描述、开始时间、结束时间、负责人、处理人、处理方法。
