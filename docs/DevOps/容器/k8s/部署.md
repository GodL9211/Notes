# 部署

## minikube

：一个命令行工具，可以部署一个单节点的 k8s 集群，常用于测试。
- 可以在本机部署多个 k8s 集群。每个 k8s 集群位于一个容器内，包含多个进程。

### 部署

1. 安装 docker
2. 下载 minikube ：
    ```sh
    curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
    sudo install minikube-linux-amd64 /usr/local/bin/
    ```

3. 以非 root 用户部署 k8s ：
    ```sh
    useradd leo
    usermod leo -G docker
    su - leo
    minikube start
    ```

3. 在本机安装 kubectl ，或使用 minikube 内置的 kubectl ：
    ```sh
    minikube kubectl -- get pods -A
    ```

### 命令

```sh
minikube
        start                             # 部署一个 k8s 集群
            -p <name>                     # --profile ，指定 k8s 集群的名称，默认为 minikube
            --driver docker               # 选择驱动，默认会自动选择
            --kubernetes-version v1.2.3   # 选择版本。默认采用最新的 stable 版本
        stop
        delete          # 删除当前 k8s 集群
            -p <name>   # 指定 k8s 集群的名称
            --all       # 删除所有 k8s 集群
        pause           # 暂停运行
        unpase

        profile         # 显示当前 k8s 集群的名称
            list        # 显示所有 k8s 集群
        status
```
<!-- 
## kubeadm

：用于部署标准的 k8s -->

## kubectl

：k8s 集群的管理工具。

### 安装

```sh
VERSION=v1.23.1
curl -LO "https://dl.k8s.io/release/v1.23.1/bin/linux/amd64/kubectl"
sudo install kubectl /usr/local/bin/
```

### 命令

```sh
kubectl
        version                 # 查看 client 和 server 的 version
        cluster-info            # 查看当前集群的信息

        create
            -f <file>           # 根据配置文件创建对象

        get
            nodes [name]        # 显示所有（或指定）的 node 的信息
                -o wide         # 显示更宽的信息
                -o json         # 显示成 JSON 格式
                -o yaml         # 显示成 YAML 格式
            pods [name]         # 显示所有（或指定）的 pods 的信息（默认是当前命名空间的）
            services [name]     # 显示所有（或指定）的服务的信息
            deployments [name]

        delete
            -f ….json           # 删除 json 文件中指定的资源
            deployment <name>   # 删除指定的 deployment
            pods <name>         # 删除指定的 pod（如果 deployment 没被删除，kubelet 就会重新创建这种 pod）
            pods --all          # 删除所有的 pod


        exec
            <pod> <command>            # 在 pod 中执行命令（默认选择第一个容器）
            <pod> -c <容器> <command>  # 在 pod 中的指定容器中执行命令
            -it <pod> -c <容器> bash   # 进入 pod 中的指定容器的终端
```
